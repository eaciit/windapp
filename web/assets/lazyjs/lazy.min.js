!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.Lazy=b()}(this,function(context){function Lazy(a){if(a instanceof Array)return new ArrayWrapper(a);if("string"==typeof a)return new StringWrapper(a);if(a instanceof Sequence)return a;if(Lazy.extensions){for(var b,c=Lazy.extensions,d=c.length;!b&&d--;)b=c[d](a);if(b)return b}return new ObjectWrapper(a)}function Sequence(){}function Iterator(a){this.sequence=a,this.index=-1}function MemoizedSequence(a){this.parent=a}function MappedSequence(a,b){this.parent=a,this.mapFn=b}function MappingIterator(a,b){this.iterator=a.getIterator(),this.mapFn=b,this.index=-1}function FilteredSequence(a,b){this.parent=a,this.filterFn=b}function FilteringIterator(a,b){this.iterator=a.getIterator(),this.filterFn=b,this.index=0}function ReversedSequence(a){this.parent=a}function ReversedIterator(a){this.sequence=a}function ConcatenatedSequence(a,b){this.parent=a,this.arrays=b}function TakeSequence(a,b){this.parent=a,this.count=b}function TakeIterator(a,b){this.iterator=a.getIterator(),this.count=b}function TakeWhileSequence(a,b){this.parent=a,this.predicate=b}function InitialSequence(a,b){this.parent=a,this.count="number"==typeof b?b:1}function DropSequence(a,b){this.parent=a,this.count="number"==typeof b?b:1}function DropWhileSequence(a,b){this.parent=a,this.predicate=b}function SortedSequence(a,b){this.parent=a,this.sortFn=b}function GroupedSequence(a,b,c){this.parent=a,this.keyFn=b,this.valFn=c}function IndexedSequence(a,b,c){this.parent=a,this.keyFn=b,this.valFn=c}function CountedSequence(a,b){this.parent=a,this.keyFn=b}function UniqueSequence(a,b){this.parent=a,this.keyFn=b}function ZippedSequence(a,b){this.parent=a,this.arrays=b}function ShuffledSequence(a){this.parent=a}function FlattenedSequence(a){this.parent=a}function WithoutSequence(a,b){this.parent=a,this.values=b}function IntersectionSequence(a,b){this.parent=a,this.arrays=b}function UniqueMemoizer(a){this.iterator=a,this.set=new Set,this.memo=[],this.currentValue=void 0}function ChunkedSequence(a,b){this.parent=a,this.chunkSize=b}function ChunkedIterator(a,b){this.iterator=a.getIterator(),this.size=b}function TappedSequence(a,b){this.parent=a,this.callback=b}function SimpleIntersectionSequence(a,b){this.parent=a,this.array=b,this.each=getEachForIntersection(b)}function getEachForIntersection(a){return a.length<40?SimpleIntersectionSequence.prototype.eachArrayCache:SimpleIntersectionSequence.prototype.eachMemoizerCache}function SimpleZippedSequence(a,b){this.parent=a,this.array=b}function ArrayLikeSequence(){}function IndexedIterator(a){this.sequence=a,this.index=-1}function IndexedMappedSequence(a,b){this.parent=a,this.mapFn=b}function IndexedFilteredSequence(a,b){this.parent=a,this.filterFn=b}function IndexedReversedSequence(a){this.parent=a}function IndexedTakeSequence(a,b){this.parent=a,this.count=b}function IndexedDropSequence(a,b){this.parent=a,this.count="number"==typeof b?b:1}function IndexedConcatenatedSequence(a,b){this.parent=a,this.other=b}function IndexedUniqueSequence(a,b){this.parent=a,this.each=getEachForParent(a),this.keyFn=b}function getEachForParent(a){return a.length()<100?IndexedUniqueSequence.prototype.eachArrayCache:UniqueSequence.prototype.each}function ArrayWrapper(a){this.source=a}function MappedArrayWrapper(a,b){this.parent=a,this.mapFn=b}function FilteredArrayWrapper(a,b){this.parent=a,this.filterFn=b}function UniqueArrayWrapper(a,b){this.parent=a,this.each=getEachForSource(a.source),this.keyFn=b}function getEachForSource(a){return a.length<40?UniqueArrayWrapper.prototype.eachNoCache:a.length<100?UniqueArrayWrapper.prototype.eachArrayCache:UniqueArrayWrapper.prototype.eachSetCache}function ConcatArrayWrapper(a,b){this.parent=a,this.other=b}function ObjectLikeSequence(){}function FilteredObjectLikeSequence(a,b){this.parent=a,this.filterFn=b}function AssignSequence(a,b){this.parent=a,this.other=b}function DefaultsSequence(a,b){this.parent=a,this.defaults=b}function InvertedSequence(a){this.parent=a}function MergedSequence(a,b,c){this.parent=a,this.others=b,this.mergeFn=c}function mergeObjects(a,b){var c,d;if("undefined"==typeof b)return a;if(isVanillaObject(a)&&isVanillaObject(b))c={};else{if(!(a instanceof Array&&b instanceof Array))return b;c=[]}for(d in a)c[d]=mergeObjects(a[d],b[d]);for(d in b)c[d]||(c[d]=b[d]);return c}function isVanillaObject(a){return a&&a.constructor===Object}function PickSequence(a,b){this.parent=a,this.properties=b}function OmitSequence(a,b){this.parent=a,this.properties=b}function ObjectWrapper(a){this.source=a}function StringLikeSequence(){}function CharIterator(a){this.source=Lazy(a),this.index=-1}function StringSegment(a,b,c){this.parent=a,this.start=Math.max(0,b),this.stop=c}function MappedStringLikeSequence(a,b){this.parent=a,this.mapFn=b}function ReversedStringLikeSequence(a){this.parent=a}function StringMatchSequence(a,b){this.parent=a,this.pattern=b}function StringMatchIterator(a,b){this.source=a,this.pattern=cloneRegex(b)}function SplitStringSequence(a,b){this.parent=a,this.pattern=b}function SplitWithRegExpIterator(a,b){this.source=a,this.pattern=cloneRegex(b)}function SplitWithStringIterator(a,b){this.source=a,this.delimiter=b}function StringWrapper(a){this.source=a}function GeneratedSequence(a,b){this.get=a,this.fixedLength=b}function GeneratedIterator(a){this.sequence=a,this.index=0,this.currentValue=null}function AsyncSequence(a,b){if(a instanceof AsyncSequence)throw new Error("Sequence is already asynchronous!");this.parent=a,this.interval=b,this.onNextCallback=getOnNextCallback(b),this.cancelCallback=getCancelCallback(b)}function AsyncHandle(a){this.resolveListeners=[],this.rejectListeners=[],this.state=PENDING,this.cancelFn=a}function resolve(a,b){if(a===b)return void a._reject(new TypeError("Cannot resolve a promise to itself"));if(b instanceof AsyncHandle)return void b.then(function(b){resolve(a,b)},function(b){a._reject(b)});var c;try{c=/function|object/.test(typeof b)&&null!=b&&b.then}catch(b){return void a._reject(b)}var d=PENDING;if("function"!=typeof c)a._resolve(b);else try{c.call(b,function(b){d===PENDING&&(d=RESOLVED,resolve(a,b))},function(b){d===PENDING&&(d=REJECTED,a._reject(b))})}catch(b){if(d!==PENDING)return;a._reject(b)}}function consumeListeners(a,b,c){c||(c=getOnNextCallback()),c(function(){a.length>0&&(a.shift()(b),consumeListeners(a,b,c))})}function getOnNextCallback(a){return"undefined"==typeof a&&"function"==typeof setImmediate?setImmediate:(a=a||0,function(b){return setTimeout(b,a)})}function getCancelCallback(a){return"undefined"==typeof a&&"function"==typeof clearImmediate?clearImmediate:clearTimeout}function transform(a,b){return b instanceof AsyncHandle?b.then(function(){a(b)}):a(b)}function WatchedPropertySequence(a,b){this.listeners=[],b?b instanceof Array||(b=[b]):b=Lazy(a).keys().toArray();var c=this.listeners,d=0;Lazy(b).each(function(b){var e=a[b];Object.defineProperty(a,b,{get:function(){return e},set:function(a){for(var f=c.length-1;f>=0;--f)c[f]({property:b,value:a},d)===!1&&c.splice(f,1);e=a,++d}})})}function StreamLikeSequence(){}function SplitStreamSequence(a,b){this.parent=a,this.delimiter=b,this.each=this.getEachForDelimiter(b)}function MatchedStreamSequence(a,b){this.parent=a,this.pattern=cloneRegex(b)}function createCallback(a,b){switch(typeof a){case"function":return a;case"string":return function(b){return b[a]};case"object":return function(b){return Lazy(a).all(function(a,c){return b[c]===a})};case"undefined":return b?function(){return b}:Lazy.identity;default:throw new Error("Don't know how to make a callback from a "+typeof a+"!")}}function createComparator(a){return a?(a=createCallback(a),function(b,c){return compare(a(b),a(c))}):compare}function reverseArguments(a){return function(b,c){return a(c,b)}}function createSet(a){var b=new Set;return Lazy(a||[]).flatten().each(function(a){b.add(a)}),b}function compare(a,b){return a===b?0:a>b?1:-1}function forEach(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c)===!1)return!1;return!0}function getFirst(a){var b;return a.each(function(a){return b=a,!1}),b}function arrayContains(a,b){var c=-1,d=a.length;if(b!==b){for(;++c<d;)if(a[c]!==a[c])return!0;return!1}for(;++c<d;)if(a[c]===b)return!0;return!1}function arrayContainsBefore(a,b,c,d){var e=-1;if(d){for(d=createCallback(d);++e<c;)if(d(a[e])===d(b))return!0}else for(;++e<c;)if(a[e]===b)return!0;return!1}function swap(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function cloneRegex(pattern){return eval(""+pattern+(pattern.global?"":"g"))}function Set(){this.table={},this.objects=[]}function Queue(a){this.contents=new Array(a),this.start=0,this.count=0}function defineSequenceType(a,b,c){var d=function(){};d.prototype=new a;for(var e in c)d.prototype[e]=c[e];for(var f=function(){var a=new d;return a.parent=this,a.init&&a.init.apply(a,arguments),a},g="string"==typeof b?[b]:b,h=0;h<g.length;++h)a.prototype[g[h]]=f;return d}Lazy.VERSION="0.4.2",Lazy.noop=function(){},Lazy.identity=function(a){return a},Lazy.strict=function(){function a(a){if(null==a)throw new Error("You cannot wrap null or undefined using Lazy.");if("number"==typeof a||"boolean"==typeof a)throw new Error("You cannot wrap primitive values using Lazy.");return Lazy(a)}return Lazy(Lazy).each(function(b,c){a[c]=b}),a},Sequence.define=function(a,b){if(!b||!b.getIterator&&!b.each)throw new Error("A custom sequence must implement *at least* getIterator or each!");return defineSequenceType(Sequence,a,b)},Sequence.prototype.size=function(){return this.getIndex().length()},Sequence.prototype.getIterator=function(){return new Iterator(this)},Sequence.prototype.root=function(){return this.parent.root()},Sequence.prototype.isAsync=function(){return!!this.parent&&this.parent.isAsync()},Sequence.prototype.value=function(){return this.toArray()},Sequence.prototype.apply=function(a){var b,c=this.root(),d=c.source;try{c.source=a,b=this.value()}finally{c.source=d}return b},Iterator.prototype.current=function(){return this.cachedIndex&&this.cachedIndex.get(this.index)},Iterator.prototype.moveNext=function(){var a=this.cachedIndex;return a||(a=this.cachedIndex=this.sequence.getIndex()),!(this.index>=a.length()-1)&&(++this.index,!0)},Sequence.prototype.toArray=function(){return this.reduce(function(a,b){return a.push(b),a},[])},Sequence.prototype.getIndex=function(){return new ArrayWrapper(this.toArray())},Sequence.prototype.get=function(a){var b;return this.each(function(c,d){return d===a?(b=c,!1):void 0}),b},Sequence.prototype.memoize=function(){return new MemoizedSequence(this)},Sequence.prototype.toObject=function(){return this.reduce(function(a,b){return a[b[0]]=b[1],a},{})},Sequence.prototype.each=function(a){for(var b=this.getIterator(),c=-1;b.moveNext();)if(a(b.current(),++c)===!1)return!1;return!0},Sequence.prototype.forEach=function(a){return this.each(a)},Sequence.prototype.map=function(a){return new MappedSequence(this,createCallback(a))},Sequence.prototype.collect=function(a){return this.map(a)},MappedSequence.prototype=new Sequence,MappedSequence.prototype.getIterator=function(){return new MappingIterator(this.parent,this.mapFn)},MappedSequence.prototype.each=function(a){var b=this.mapFn;return this.parent.each(function(c,d){return a(b(c,d),d)})},MappingIterator.prototype.current=function(){return this.mapFn(this.iterator.current(),this.index)},MappingIterator.prototype.moveNext=function(){return!!this.iterator.moveNext()&&(++this.index,!0)},Sequence.prototype.pluck=function(a){return this.map(a)},Sequence.prototype.invoke=function(a){return this.map(function(b){return b[a]()})},Sequence.prototype.filter=function(a){return new FilteredSequence(this,createCallback(a))},Sequence.prototype.select=function(a){return this.filter(a)},FilteredSequence.prototype=new Sequence,FilteredSequence.prototype.getIterator=function(){return new FilteringIterator(this.parent,this.filterFn)},FilteredSequence.prototype.each=function(a){var b=this.filterFn,c=0;return this.parent.each(function(d,e){return b(d,e)?a(d,c++):void 0})},FilteredSequence.prototype.reverse=function(){return this.parent.reverse().filter(this.filterFn)},FilteringIterator.prototype.current=function(){return this.value},FilteringIterator.prototype.moveNext=function(){for(var a,b=this.iterator,c=this.filterFn;b.moveNext();)if(a=b.current(),c(a,this.index++))return this.value=a,!0;return this.value=void 0,!1},Sequence.prototype.reject=function(a){return a=createCallback(a),this.filter(function(b){return!a(b)})},Sequence.prototype.ofType=function(a){return this.filter(function(b){return typeof b===a})},Sequence.prototype.where=function(a){return this.filter(a)},Sequence.prototype.reverse=function(){return new ReversedSequence(this)},ReversedSequence.prototype=new Sequence,ReversedSequence.prototype.getIterator=function(){return new ReversedIterator(this.parent)},ReversedIterator.prototype.current=function(){return this.getIndex().get(this.index)},ReversedIterator.prototype.moveNext=function(){var a=this.getIndex(),b=a.length();return"undefined"==typeof this.index&&(this.index=b),--this.index>=0},ReversedIterator.prototype.getIndex=function(){return this.cachedIndex||(this.cachedIndex=this.sequence.getIndex()),this.cachedIndex},Sequence.prototype.concat=function(){return new ConcatenatedSequence(this,arraySlice.call(arguments,0))},ConcatenatedSequence.prototype=new Sequence,ConcatenatedSequence.prototype.each=function(a){var b=!1,c=0;this.parent.each(function(d){return a(d,c++)===!1?(b=!0,!1):void 0}),b||Lazy(this.arrays).flatten().each(function(b){return a(b,c++)!==!1&&void 0})},Sequence.prototype.first=function(a){return"undefined"==typeof a?getFirst(this):new TakeSequence(this,a)},Sequence.prototype.head=Sequence.prototype.take=function(a){return this.first(a)},TakeSequence.prototype=new Sequence,TakeSequence.prototype.getIterator=function(){return new TakeIterator(this.parent,this.count)},TakeSequence.prototype.each=function(a){var b,c=this.count,d=0,e=this.parent.each(function(e){return c>d&&(b=a(e,d++)),!(d>=c)&&b});return e instanceof AsyncHandle?e:d===c&&b!==!1},TakeIterator.prototype.current=function(){return this.iterator.current()},TakeIterator.prototype.moveNext=function(){return--this.count>=0&&this.iterator.moveNext()},Sequence.prototype.takeWhile=function(a){return new TakeWhileSequence(this,a)},TakeWhileSequence.prototype=new Sequence,TakeWhileSequence.prototype.each=function(a){var b=this.predicate,c=!1,d=0,e=this.parent.each(function(e,f){return b(e,f)?a(e,d++):(c=!0,!1)});return e instanceof AsyncHandle?e:c},Sequence.prototype.initial=function(a){return new InitialSequence(this,a)},InitialSequence.prototype=new Sequence,InitialSequence.prototype.each=function(a){var b=this.parent.getIndex();return b.take(b.length()-this.count).each(a)},Sequence.prototype.last=function(a){return"undefined"==typeof a?this.reverse().first():this.reverse().take(a).reverse()},Sequence.prototype.findWhere=function(a){return this.where(a).first()},Sequence.prototype.rest=function(a){return new DropSequence(this,a)},Sequence.prototype.skip=Sequence.prototype.tail=Sequence.prototype.drop=function(a){return this.rest(a)},DropSequence.prototype=new Sequence,DropSequence.prototype.each=function(a){var b=this.count,c=0,d=0;return this.parent.each(function(e){return c++<b?void 0:a(e,d++)})},Sequence.prototype.dropWhile=function(a){return new DropWhileSequence(this,a)},Sequence.prototype.skipWhile=function(a){return this.dropWhile(a)},DropWhileSequence.prototype=new Sequence,DropWhileSequence.prototype.each=function(a){var b=this.predicate,c=!1;return this.parent.each(function(d){if(!c){if(b(d))return;c=!0}return a(d)})},Sequence.prototype.sort=function(a,b){return a||(a=compare),b&&(a=reverseArguments(a)),new SortedSequence(this,a)},Sequence.prototype.sortBy=function(a,b){return a=createComparator(a),b&&(a=reverseArguments(a)),new SortedSequence(this,a)},SortedSequence.prototype=new Sequence,SortedSequence.prototype.each=function(a){var b=this.sortFn,c=this.parent.toArray();return c.sort(b),forEach(c,a)},SortedSequence.prototype.reverse=function(){return new SortedSequence(this.parent,reverseArguments(this.sortFn))},Sequence.prototype.groupBy=function(a,b){return new GroupedSequence(this,a,b)},Sequence.prototype.indexBy=function(a,b){return new IndexedSequence(this,a,b)},Sequence.prototype.countBy=function(a){return new CountedSequence(this,a)},Sequence.prototype.uniq=function(a){return new UniqueSequence(this,a)},Sequence.prototype.unique=function(a){return this.uniq(a)},UniqueSequence.prototype=new Sequence,UniqueSequence.prototype.each=function(a){var b=new Set,c=this.keyFn,d=0;return c?(c=createCallback(c),this.parent.each(function(e){return b.add(c(e))?a(e,d++):void 0})):this.parent.each(function(c){return b.add(c)?a(c,d++):void 0})},Sequence.prototype.zip=function(a){return 1===arguments.length?new SimpleZippedSequence(this,a):new ZippedSequence(this,arraySlice.call(arguments,0))},ZippedSequence.prototype=new Sequence,ZippedSequence.prototype.each=function(a){var b=this.arrays,c=0;this.parent.each(function(d){for(var e=[d],f=0;f<b.length;++f)b[f].length>c&&e.push(b[f][c]);return a(e,c++)})},Sequence.prototype.shuffle=function(){return new ShuffledSequence(this)},ShuffledSequence.prototype=new Sequence,ShuffledSequence.prototype.each=function(a){for(var b=this.parent.toArray(),c=Math.floor,d=Math.random,e=0,f=b.length-1;f>0;--f)if(swap(b,f,c(d()*(f+1))),a(b[f],e++)===!1)return;a(b[0],e)},Sequence.prototype.flatten=function(){return new FlattenedSequence(this)},FlattenedSequence.prototype=new Sequence,FlattenedSequence.prototype.each=function(a){var b=0;return this.parent.each(function c(d){return d instanceof Array?forEach(d,c):d instanceof Sequence?d.each(c):a(d,b++)})},Sequence.prototype.compact=function(){return this.filter(function(a){return!!a})},Sequence.prototype.without=function(){return new WithoutSequence(this,arraySlice.call(arguments,0))},Sequence.prototype.difference=function(){return this.without.apply(this,arguments)},WithoutSequence.prototype=new Sequence,WithoutSequence.prototype.each=function(a){var b=createSet(this.values),c=0;return this.parent.each(function(d){return b.contains(d)?void 0:a(d,c++)})},Sequence.prototype.union=function(a){return this.concat(a).uniq()},Sequence.prototype.intersection=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new SimpleIntersectionSequence(this,a):new IntersectionSequence(this,arraySlice.call(arguments,0))},IntersectionSequence.prototype=new Sequence,IntersectionSequence.prototype.each=function(a){var b=Lazy(this.arrays).map(function(a){return new UniqueMemoizer(Lazy(a).getIterator())}),c=new UniqueMemoizer(b.getIterator()),d=0;return this.parent.each(function(b){var e=!0;return c.each(function(a){return a.contains(b)?void 0:(e=!1,!1)}),e?a(b,d++):void 0})},UniqueMemoizer.prototype.current=function(){return this.currentValue},UniqueMemoizer.prototype.moveNext=function(){for(var a,b=this.iterator,c=this.set,d=this.memo;b.moveNext();)if(a=b.current(),c.add(a))return d.push(a),this.currentValue=a,!0;return!1},UniqueMemoizer.prototype.each=function(a){for(var b=this.memo,c=b.length,d=-1;++d<c;)if(a(b[d],d)===!1)return!1;for(;this.moveNext()&&a(this.currentValue,d++)!==!1;);},UniqueMemoizer.prototype.contains=function(a){if(this.set.contains(a))return!0;for(;this.moveNext();)if(this.currentValue===a)return!0;return!1},Sequence.prototype.every=function(a){return a=createCallback(a),this.each(function(b,c){return!!a(b,c)})},Sequence.prototype.all=function(a){return this.every(a)},Sequence.prototype.some=function(a){a=createCallback(a,!0);var b=!1;return this.each(function(c){return a(c)?(b=!0,!1):void 0}),b},Sequence.prototype.any=function(a){return this.some(a)},Sequence.prototype.none=function(a){return!this.any(a)},Sequence.prototype.isEmpty=function(){return!this.any()},Sequence.prototype.indexOf=function(a){var b=-1;return this.each(function(c,d){return c===a?(b=d,!1):void 0}),b},Sequence.prototype.lastIndexOf=function(a){var b=this.getIndex().reverse(),c=b.indexOf(a);return-1!==c&&(c=b.length()-c-1),c},Sequence.prototype.sortedIndex=function(a){for(var b,c=this.getIndex(),d=0,e=c.length();e>d;)b=d+e>>>1,-1===compare(c.get(b),a)?d=b+1:e=b;return d},Sequence.prototype.contains=function(a){return-1!==this.indexOf(a)},Sequence.prototype.reduce=function(a,b){if(arguments.length<2)return this.tail().reduce(a,this.head());var c=this.each(function(c,d){b=a(b,c,d)});return c instanceof AsyncHandle?c.then(function(){return b}):b},Sequence.prototype.inject=Sequence.prototype.foldl=function(a,b){return this.reduce(a,b)},Sequence.prototype.reduceRight=function(a,b){if(arguments.length<2)return this.initial(1).reduceRight(a,this.last());var c=this.getIndex(),d=c.length()-1;return c.reverse().reduce(function(b,c){return a(b,c,d--)},b)},Sequence.prototype.foldr=function(a,b){return this.reduceRight(a,b)},Sequence.prototype.consecutive=function(a){var b=new Queue(a),c=this.map(function(c){return b.add(c).count===a?b.toArray():void 0});return c.compact()},Sequence.prototype.chunk=function(a){if(1>a)throw new Error("You must specify a positive chunk size.");return new ChunkedSequence(this,a)},ChunkedSequence.prototype=new Sequence,ChunkedSequence.prototype.getIterator=function(){return new ChunkedIterator(this.parent,this.chunkSize)},ChunkedIterator.prototype.current=function(){return this.currentChunk},ChunkedIterator.prototype.moveNext=function(){for(var a=this.iterator,b=this.size,c=[];c.length<b&&a.moveNext();)c.push(a.current());return 0!==c.length&&(this.currentChunk=c,!0)},Sequence.prototype.tap=function(a){return new TappedSequence(this,a)},TappedSequence.prototype=new Sequence,TappedSequence.prototype.each=function(a){var b=this.callback;return this.parent.each(function(c,d){return b(c,d),a(c,d)})},Sequence.prototype.find=function(a){return this.filter(a).first()},Sequence.prototype.detect=function(a){return this.find(a)},Sequence.prototype.min=function(a){return"undefined"!=typeof a?this.minBy(a):this.reduce(function(a,b){return a>b?b:a},1/0)},Sequence.prototype.minBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return a(c)<a(b)?c:b})},Sequence.prototype.max=function(a){return"undefined"!=typeof a?this.maxBy(a):this.reduce(function(a,b){return b>a?b:a},-1/0)},Sequence.prototype.maxBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return a(c)>a(b)?c:b})},Sequence.prototype.sum=function(a){return"undefined"!=typeof a?this.sumBy(a):this.reduce(function(a,b){return a+b},0)},Sequence.prototype.sumBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return b+a(c)},0)},Sequence.prototype.join=function(a){return a="string"==typeof a?a:",",this.reduce(function(b,c,d){return d>0&&(b+=a),b+c},"")},Sequence.prototype.toString=function(a){return this.join(a)},Sequence.prototype.async=function(a){return new AsyncSequence(this,a)},SimpleIntersectionSequence.prototype=new Sequence,SimpleIntersectionSequence.prototype.eachMemoizerCache=function(a){var b=new UniqueMemoizer(Lazy(this.array).getIterator()),c=0;return this.parent.each(function(d){return b.contains(d)?a(d,c++):void 0})},SimpleIntersectionSequence.prototype.eachArrayCache=function(a){var b=this.array,c=arrayContains,d=0;return this.parent.each(function(e){return c(b,e)?a(e,d++):void 0})},SimpleZippedSequence.prototype=new Sequence,SimpleZippedSequence.prototype.each=function(a){var b=this.array;return this.parent.each(function(c,d){return a([c,b[d]],d)})},ArrayLikeSequence.prototype=new Sequence,ArrayLikeSequence.define=function(a,b){if(!b||"function"!=typeof b.get)throw new Error("A custom array-like sequence must implement *at least* get!");return defineSequenceType(ArrayLikeSequence,a,b)},ArrayLikeSequence.prototype.get=function(a){return this.parent.get(a)},ArrayLikeSequence.prototype.length=function(){return this.parent.length()},ArrayLikeSequence.prototype.getIndex=function(){return this},ArrayLikeSequence.prototype.getIterator=function(){return new IndexedIterator(this)},IndexedIterator.prototype.current=function(){return this.sequence.get(this.index)},IndexedIterator.prototype.moveNext=function(){return!(this.index>=this.sequence.length()-1)&&(++this.index,!0)},ArrayLikeSequence.prototype.each=function(a){for(var b=this.length(),c=-1;++c<b;)if(a(this.get(c),c)===!1)return!1;return!0},ArrayLikeSequence.prototype.pop=function(){return this.initial()},ArrayLikeSequence.prototype.shift=function(){return this.drop()},ArrayLikeSequence.prototype.slice=function(a,b){var c=this.length();0>a&&(a=c+a);var d=this.drop(a);return"number"==typeof b&&(0>b&&(b=c+b),d=d.take(b-a)),d},ArrayLikeSequence.prototype.map=function(a){return new IndexedMappedSequence(this,createCallback(a))},IndexedMappedSequence.prototype=new ArrayLikeSequence,IndexedMappedSequence.prototype.get=function(a){return 0>a||a>=this.parent.length()?void 0:this.mapFn(this.parent.get(a),a)},ArrayLikeSequence.prototype.filter=function(a){return new IndexedFilteredSequence(this,createCallback(a))},IndexedFilteredSequence.prototype=new FilteredSequence,IndexedFilteredSequence.prototype.each=function(a){for(var b,c=this.parent,d=this.filterFn,e=this.parent.length(),f=-1,g=0;++f<e;)if(b=c.get(f),d(b,f)&&a(b,g++)===!1)return!1;return!0},ArrayLikeSequence.prototype.reverse=function(){return new IndexedReversedSequence(this)},IndexedReversedSequence.prototype=new ArrayLikeSequence,IndexedReversedSequence.prototype.get=function(a){return this.parent.get(this.length()-a-1)},ArrayLikeSequence.prototype.first=function(a){return"undefined"==typeof a?this.get(0):new IndexedTakeSequence(this,a)},IndexedTakeSequence.prototype=new ArrayLikeSequence,IndexedTakeSequence.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a},ArrayLikeSequence.prototype.rest=function(a){return new IndexedDropSequence(this,a)},IndexedDropSequence.prototype=new ArrayLikeSequence,IndexedDropSequence.prototype.get=function(a){return this.parent.get(this.count+a)},IndexedDropSequence.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0},ArrayLikeSequence.prototype.concat=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new IndexedConcatenatedSequence(this,a):Sequence.prototype.concat.apply(this,arguments)},IndexedConcatenatedSequence.prototype=new ArrayLikeSequence,IndexedConcatenatedSequence.prototype.get=function(a){var b=this.parent.length();return b>a?this.parent.get(a):this.other[a-b]},IndexedConcatenatedSequence.prototype.length=function(){return this.parent.length()+this.other.length},ArrayLikeSequence.prototype.uniq=function(a){return new IndexedUniqueSequence(this,createCallback(a))},IndexedUniqueSequence.prototype=new Sequence,IndexedUniqueSequence.prototype.eachArrayCache=function(a){for(var b,c,d=this.parent,e=this.keyFn,f=d.length(),g=[],h=arrayContains,i=-1,j=0;++i<f;)if(c=d.get(i),b=e(c),!h(g,b)&&(g.push(b),a(c,j++)===!1))return!1},IndexedUniqueSequence.prototype.eachSetCache=UniqueSequence.prototype.each,MemoizedSequence.prototype=new ArrayLikeSequence,MemoizedSequence.prototype.cache=function(){return this.cachedResult||(this.cachedResult=this.parent.toArray())},MemoizedSequence.prototype.get=function(a){return this.cache()[a]},MemoizedSequence.prototype.length=function(){return this.cache().length},MemoizedSequence.prototype.slice=function(a,b){return this.cache().slice(a,b)},MemoizedSequence.prototype.toArray=function(){return this.cache().slice(0)},ArrayWrapper.prototype=new ArrayLikeSequence,ArrayWrapper.prototype.root=function(){return this},ArrayWrapper.prototype.isAsync=function(){return!1},ArrayWrapper.prototype.get=function(a){return this.source[a]},ArrayWrapper.prototype.length=function(){return this.source.length},ArrayWrapper.prototype.each=function(a){return forEach(this.source,a)},ArrayWrapper.prototype.map=function(a){return new MappedArrayWrapper(this,createCallback(a))},ArrayWrapper.prototype.filter=function(a){return new FilteredArrayWrapper(this,createCallback(a))},ArrayWrapper.prototype.uniq=function(a){return new UniqueArrayWrapper(this,a)},ArrayWrapper.prototype.concat=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new ConcatArrayWrapper(this,a):ArrayLikeSequence.prototype.concat.apply(this,arguments)},ArrayWrapper.prototype.toArray=function(){return this.source.slice(0)},MappedArrayWrapper.prototype=new ArrayLikeSequence,MappedArrayWrapper.prototype.get=function(a){var b=this.parent.source;return 0>a||a>=b.length?void 0:this.mapFn(b[a])},MappedArrayWrapper.prototype.length=function(){return this.parent.source.length},MappedArrayWrapper.prototype.each=function(a){for(var b=this.parent.source,c=b.length,d=this.mapFn,e=-1;++e<c;)if(a(d(b[e],e),e)===!1)return!1;return!0},FilteredArrayWrapper.prototype=new FilteredSequence,FilteredArrayWrapper.prototype.each=function(a){for(var b,c=this.parent.source,d=this.filterFn,e=c.length,f=-1,g=0;++f<e;)if(b=c[f],d(b,f)&&a(b,g++)===!1)return!1;return!0},UniqueArrayWrapper.prototype=new Sequence,UniqueArrayWrapper.prototype.eachNoCache=function(a){for(var b,c=this.parent.source,d=this.keyFn,e=c.length,f=arrayContainsBefore,g=-1,h=0;++g<e;)if(b=c[g],!f(c,b,g,d)&&a(b,h++)===!1)return!1;return!0},UniqueArrayWrapper.prototype.eachArrayCache=function(a){var b,c,d=this.parent.source,e=this.keyFn,f=d.length,g=[],h=arrayContains,i=-1,j=0;if(e){for(e=createCallback(e);++i<f;)if(c=d[i],b=e(c),!h(g,b)&&(g.push(b),a(c,j++)===!1))return!1}else for(;++i<f;)if(c=d[i],!h(g,c)&&(g.push(c),a(c,j++)===!1))return!1;return!0},UniqueArrayWrapper.prototype.eachSetCache=UniqueSequence.prototype.each,ConcatArrayWrapper.prototype=new ArrayLikeSequence,ConcatArrayWrapper.prototype.get=function(a){var b=this.parent.source,c=b.length;return c>a?b[a]:this.other[a-c]},ConcatArrayWrapper.prototype.length=function(){return this.parent.source.length+this.other.length},ConcatArrayWrapper.prototype.each=function(a){for(var b=this.parent.source,c=b.length,d=this.other,e=d.length,f=0,g=-1;++g<c;)if(a(b[g],f++)===!1)return!1;for(g=-1;++g<e;)if(a(d[g],f++)===!1)return!1;return!0},ObjectLikeSequence.prototype=new Sequence,ObjectLikeSequence.define=function(a,b){if(!b||"function"!=typeof b.each)throw new Error("A custom object-like sequence must implement *at least* each!");return defineSequenceType(ObjectLikeSequence,a,b)},ObjectLikeSequence.prototype.value=function(){return this.toObject()},ObjectLikeSequence.prototype.get=function(a){var b=this.pairs().find(function(b){return b[0]===a});return b?b[1]:void 0},ObjectLikeSequence.prototype.keys=function(){return this.map(function(a,b){return b})},ObjectLikeSequence.prototype.values=function(){return this.map(function(a){return a})},ObjectLikeSequence.prototype.async=function(){throw new Error("An ObjectLikeSequence does not support asynchronous iteration.")},ObjectLikeSequence.prototype.filter=function(a){return new FilteredObjectLikeSequence(this,createCallback(a))},FilteredObjectLikeSequence.prototype=new ObjectLikeSequence,FilteredObjectLikeSequence.prototype.each=function(a){var b=this.filterFn;return this.parent.each(function(c,d){return b(c,d)?a(c,d):void 0})},ObjectLikeSequence.prototype.reverse=function(){return this},ObjectLikeSequence.prototype.assign=function(a){return new AssignSequence(this,a)},ObjectLikeSequence.prototype.extend=function(a){return this.assign(a)},AssignSequence.prototype=new ObjectLikeSequence,AssignSequence.prototype.get=function(a){return this.other[a]||this.parent.get(a)},AssignSequence.prototype.each=function(a){var b=new Set,c=!1;return Lazy(this.other).each(function(d,e){return a(d,e)===!1?(c=!0,!1):void b.add(e)}),c?void 0:this.parent.each(function(c,d){return!(!b.contains(d)&&a(c,d)===!1)&&void 0})},ObjectLikeSequence.prototype.defaults=function a(a){return new DefaultsSequence(this,a)},DefaultsSequence.prototype=new ObjectLikeSequence,DefaultsSequence.prototype.get=function(a){return this.parent.get(a)||this.defaults[a]},DefaultsSequence.prototype.each=function(a){
var b=new Set,c=!1;this.parent.each(function(d,e){return a(d,e)===!1?(c=!0,!1):void("undefined"!=typeof d&&b.add(e))}),c||Lazy(this.defaults).each(function(c,d){return!(!b.contains(d)&&a(c,d)===!1)&&void 0})},ObjectLikeSequence.prototype.invert=function(){return new InvertedSequence(this)},InvertedSequence.prototype=new ObjectLikeSequence,InvertedSequence.prototype.each=function(a){this.parent.each(function(b,c){return a(c,b)})},ObjectLikeSequence.prototype.merge=function(){var a=arguments.length>1&&"function"==typeof arguments[arguments.length-1]?arrayPop.call(arguments):null;return new MergedSequence(this,arraySlice.call(arguments,0),a)},MergedSequence.prototype=new ObjectLikeSequence,MergedSequence.prototype.each=function(a){var b=this.others,c=this.mergeFn||mergeObjects,d={},e=this.parent.each(function(e,f){var g=e;return forEach(b,function(a){f in a&&(g=c(g,a[f]))}),d[f]=!0,a(g,f)});if(e===!1)return!1;var f={};return forEach(b,function(a){for(var b in a)d[b]||(f[b]=c(f[b],a[b]))}),Lazy(f).each(a)},ObjectLikeSequence.prototype.functions=function(){return this.filter(function(a){return"function"==typeof a}).map(function(a,b){return b})},ObjectLikeSequence.prototype.methods=function(){return this.functions()},ObjectLikeSequence.prototype.pick=function(a){return new PickSequence(this,a)},PickSequence.prototype=new ObjectLikeSequence,PickSequence.prototype.get=function(a){return arrayContains(this.properties,a)?this.parent.get(a):void 0},PickSequence.prototype.each=function(a){var b=arrayContains,c=this.properties;return this.parent.each(function(d,e){return b(c,e)?a(d,e):void 0})},ObjectLikeSequence.prototype.omit=function(a){return new OmitSequence(this,a)},OmitSequence.prototype=new ObjectLikeSequence,OmitSequence.prototype.get=function(a){return arrayContains(this.properties,a)?void 0:this.parent.get(a)},OmitSequence.prototype.each=function(a){var b=arrayContains,c=this.properties;return this.parent.each(function(d,e){return b(c,e)?void 0:a(d,e)})},ObjectLikeSequence.prototype.pairs=function(){return this.map(function(a,b){return[b,a]})},ObjectLikeSequence.prototype.toArray=function(){return this.pairs().toArray()},ObjectLikeSequence.prototype.toObject=function(){return this.reduce(function(a,b,c){return a[c]=b,a},{})},GroupedSequence.prototype=new ObjectLikeSequence,GroupedSequence.prototype.each=function(a){var b,c=createCallback(this.keyFn),d=createCallback(this.valFn);return b=this.parent.reduce(function(a,b){var e=c(b),f=d(b);return a[e]instanceof Array?a[e].push(f):a[e]=[f],a},{}),transform(function(b){for(var c in b)if(a(b[c],c)===!1)return!1},b)},IndexedSequence.prototype=new ObjectLikeSequence,IndexedSequence.prototype.each=function(a){var b=createCallback(this.keyFn),c=createCallback(this.valFn),d={};return this.parent.each(function(e){var f=b(e),g=c(e);return d[f]?void 0:(d[f]=g,a(g,f))})},CountedSequence.prototype=new ObjectLikeSequence,CountedSequence.prototype.each=function(a){var b=createCallback(this.keyFn),c={};this.parent.each(function(a){var d=b(a);c[d]?c[d]+=1:c[d]=1});for(var d in c)if(a(c[d],d)===!1)return!1;return!0},ObjectLikeSequence.prototype.watch=function(){throw new Error("You can only call #watch on a directly wrapped object.")},ObjectWrapper.prototype=new ObjectLikeSequence,ObjectWrapper.prototype.root=function(){return this},ObjectWrapper.prototype.isAsync=function(){return!1},ObjectWrapper.prototype.get=function(a){return this.source[a]},ObjectWrapper.prototype.each=function(a){var b,c=this.source;for(b in c)if(a(c[b],b)===!1)return!1;return!0},StringLikeSequence.prototype=new ArrayLikeSequence,StringLikeSequence.define=function(a,b){if(!b||"function"!=typeof b.get)throw new Error("A custom string-like sequence must implement *at least* get!");return defineSequenceType(StringLikeSequence,a,b)},StringLikeSequence.prototype.value=function(){return this.toString()},StringLikeSequence.prototype.getIterator=function(){return new CharIterator(this)},CharIterator.prototype.current=function(){return this.source.charAt(this.index)},CharIterator.prototype.moveNext=function(){return++this.index<this.source.length()},StringLikeSequence.prototype.charAt=function(a){return this.get(a)},StringLikeSequence.prototype.charCodeAt=function(a){var b=this.charAt(a);return b?b.charCodeAt(0):NaN},StringLikeSequence.prototype.substring=function(a,b){return new StringSegment(this,a,b)},StringSegment.prototype=new StringLikeSequence,StringSegment.prototype.get=function(a){return this.parent.get(a+this.start)},StringSegment.prototype.length=function(){return("number"==typeof this.stop?this.stop:this.parent.length())-this.start},StringLikeSequence.prototype.first=function(a){return"undefined"==typeof a?this.charAt(0):this.substring(0,a)},StringLikeSequence.prototype.last=function(a){return"undefined"==typeof a?this.charAt(this.length()-1):this.substring(this.length()-a)},StringLikeSequence.prototype.drop=function(a){return this.substring(a)},StringLikeSequence.prototype.indexOf=function(a,b){return this.toString().indexOf(a,b)},StringLikeSequence.prototype.lastIndexOf=function(a,b){return this.toString().lastIndexOf(a,b)},StringLikeSequence.prototype.contains=function(a){return-1!==this.indexOf(a)},StringLikeSequence.prototype.endsWith=function(a){return this.substring(this.length()-a.length).toString()===a},StringLikeSequence.prototype.startsWith=function(a){return this.substring(0,a.length).toString()===a},StringLikeSequence.prototype.toUpperCase=function(){return this.mapString(function(a){return a.toUpperCase()})},StringLikeSequence.prototype.toLowerCase=function(){return this.mapString(function(a){return a.toLowerCase()})},StringLikeSequence.prototype.mapString=function(a){return new MappedStringLikeSequence(this,a)},MappedStringLikeSequence.prototype=new StringLikeSequence,MappedStringLikeSequence.prototype.get=IndexedMappedSequence.prototype.get,MappedStringLikeSequence.prototype.length=IndexedMappedSequence.prototype.length,StringLikeSequence.prototype.reverse=function(){return new ReversedStringLikeSequence(this)},ReversedStringLikeSequence.prototype=new StringLikeSequence,ReversedStringLikeSequence.prototype.get=IndexedReversedSequence.prototype.get,ReversedStringLikeSequence.prototype.length=IndexedReversedSequence.prototype.length,StringLikeSequence.prototype.toString=function(){return this.join("")},StringLikeSequence.prototype.match=function(a){return new StringMatchSequence(this,a)},StringMatchSequence.prototype=new Sequence,StringMatchSequence.prototype.getIterator=function(){return new StringMatchIterator(this.parent.toString(),this.pattern)},StringMatchIterator.prototype.current=function(){return this.match[0]},StringMatchIterator.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))},StringLikeSequence.prototype.split=function(a){return new SplitStringSequence(this,a)},SplitStringSequence.prototype=new Sequence,SplitStringSequence.prototype.getIterator=function(){var a=this.parent.toString();return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new CharIterator(a):new SplitWithRegExpIterator(a,this.pattern):""===this.pattern?new CharIterator(a):new SplitWithStringIterator(a,this.pattern)},SplitWithRegExpIterator.prototype.current=function(){return this.source.substring(this.start,this.end)},SplitWithRegExpIterator.prototype.moveNext=function(){if(!this.pattern)return!1;var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,!0):!!this.pattern&&(this.start=this.nextStart,this.end=void 0,this.nextStart=void 0,this.pattern=void 0,!0)},SplitWithStringIterator.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)},SplitWithStringIterator.prototype.moveNext=function(){return this.finished||(this.leftIndex="undefined"!=typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex)),-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished},StringWrapper.prototype=new StringLikeSequence,StringWrapper.prototype.root=function(){return this},StringWrapper.prototype.isAsync=function(){return!1},StringWrapper.prototype.get=function(a){return this.source.charAt(a)},StringWrapper.prototype.length=function(){return this.source.length},StringWrapper.prototype.toString=function(){return this.source},GeneratedSequence.prototype=new Sequence,GeneratedSequence.prototype.isAsync=function(){return!1},GeneratedSequence.prototype.length=function(){return this.fixedLength},GeneratedSequence.prototype.each=function(a){for(var b=this.get,c=this.fixedLength,d=0;"undefined"==typeof c||c>d;)if(a(b(d),d++)===!1)return!1;return!0},GeneratedSequence.prototype.getIterator=function(){return new GeneratedIterator(this)},GeneratedIterator.prototype.current=function(){return this.currentValue},GeneratedIterator.prototype.moveNext=function(){var a=this.sequence;return!("number"==typeof a.fixedLength&&this.index>=a.fixedLength)&&(this.currentValue=a.get(this.index++),!0)},AsyncSequence.prototype=new Sequence,AsyncSequence.prototype.isAsync=function(){return!0},AsyncSequence.prototype.getIterator=function(){throw new Error("An AsyncSequence does not support synchronous iteration.")},AsyncSequence.prototype.each=function(a){var b=this.parent.getIterator(),c=this.onNextCallback,d=this.cancelCallback,e=0,f=new AsyncHandle(function(){g&&d(g)}),g=c(function d(){g=null;try{b.moveNext()&&a(b.current(),e++)!==!1?g=c(d):f._resolve()}catch(a){f._reject(a)}});return f};var PENDING=1,RESOLVED=2,REJECTED=3;AsyncHandle.prototype.then=function(a,b){var c=new AsyncHandle(this.cancelFn);return this.resolveListeners.push(function(b){try{if("function"!=typeof a)return void resolve(c,b);resolve(c,a(b))}catch(a){c._reject(a)}}),this.rejectListeners.push(function(a){try{if("function"!=typeof b)return void c._reject(a);resolve(c,b(a))}catch(a){c._reject(a)}}),this.state===RESOLVED&&this._resolve(this.value),this.state===REJECTED&&this._reject(this.reason),c},AsyncHandle.prototype._resolve=function(a){this.state!==REJECTED&&(this.state===PENDING&&(this.state=RESOLVED,this.value=a),consumeListeners(this.resolveListeners,this.value))},AsyncHandle.prototype._reject=function(a){this.state!==RESOLVED&&(this.state===PENDING&&(this.state=REJECTED,this.reason=a),consumeListeners(this.rejectListeners,this.reason))},AsyncHandle.prototype.cancel=function(){this.cancelFn&&(this.cancelFn(),this.cancelFn=null,this._resolve(!1))},AsyncHandle.prototype.onComplete=function(a){return this.resolveListeners.push(a),this},AsyncHandle.prototype.onError=function(a){return this.rejectListeners.push(a),this},AsyncSequence.prototype.reverse=function(){return this.parent.reverse().async()},AsyncSequence.prototype.find=function(a){var b,c=this.each(function(c,d){return a(c,d)?(b=c,!1):void 0});return c.then(function(){return b})},AsyncSequence.prototype.indexOf=function(a){var b=-1,c=this.each(function(c,d){return c===a?(b=d,!1):void 0});return c.then(function(){return b})},AsyncSequence.prototype.contains=function(a){var b=!1,c=this.each(function(c){return c===a?(b=!0,!1):void 0});return c.then(function(){return b})},AsyncSequence.prototype.async=function(){return this},ObjectWrapper.prototype.watch=function(a){return new WatchedPropertySequence(this.source,a)},WatchedPropertySequence.prototype=new AsyncSequence,WatchedPropertySequence.prototype.each=function(a){this.listeners.push(a)},StreamLikeSequence.prototype=new AsyncSequence,StreamLikeSequence.prototype.isAsync=function(){return!0},StreamLikeSequence.prototype.split=function(a){return new SplitStreamSequence(this,a)},SplitStreamSequence.prototype=new Sequence,SplitStreamSequence.prototype.getEachForDelimiter=function(a){return a instanceof RegExp?this.regexEach:this.stringEach},SplitStreamSequence.prototype.regexEach=function(a){var b,c=cloneRegex(this.delimiter),d="",e=0,f=0,g=this.parent.each(function(g){d+=g;for(var h;h=c.exec(d);){if(b=h.index,a(d.substring(e,b),f++)===!1)return!1;e=b+h[0].length}d=d.substring(e),e=0});return g.onComplete(function(){d.length>0&&a(d,f++)}),g},SplitStreamSequence.prototype.stringEach=function(a){var b=this.delimiter,c=0,d="",e=this.parent.each(function(e){d+=e;for(var f;(f=d.indexOf(b))>=0;){var g=d.substr(0,f);if(d=d.substr(f+b.length),a(g,c++)===!1)return!1}return!0});return e.onComplete(function(){a(d,c++)}),e},StreamLikeSequence.prototype.lines=function(){return this.split("\n")},StreamLikeSequence.prototype.match=function(a){return new MatchedStreamSequence(this,a)},MatchedStreamSequence.prototype=new AsyncSequence,MatchedStreamSequence.prototype.each=function(a){var b=this.pattern,c=!1,d=0;return this.parent.each(function(e){return Lazy(e).match(b).each(function(b){return a(b,d++)===!1?(c=!0,!1):void 0}),!c})},Lazy.createWrapper=function(a){var b=function(){this.listeners=[]};return b.prototype=new StreamLikeSequence,b.prototype.each=function(a){this.listeners.push(a)},b.prototype.emit=function(a){for(var b=this.listeners,c=b.length,d=c-1;d>=0;--d)b[d](a)===!1&&b.splice(d,1)},function(){var c=new b;return a.apply(c,arguments),c}},Lazy.generate=function(a,b){return new GeneratedSequence(a,b)},Lazy.range=function(){var a=arguments.length>1?arguments[0]:0,b=arguments.length>1?arguments[1]:arguments[0],c=arguments.length>2&&arguments[2];return c===!1&&(c=b>a?1:-1),0===c?Lazy([]):Lazy.generate(function(b){return a+c*b}).take(Math.ceil((b-a)/c))},Lazy.repeat=function(a,b){return Lazy.generate(function(){return a},b)},Lazy.Sequence=Sequence,Lazy.ArrayLikeSequence=ArrayLikeSequence,Lazy.ObjectLikeSequence=ObjectLikeSequence,Lazy.StringLikeSequence=StringLikeSequence,Lazy.StreamLikeSequence=StreamLikeSequence,Lazy.GeneratedSequence=GeneratedSequence,Lazy.AsyncSequence=AsyncSequence,Lazy.AsyncHandle=AsyncHandle,Lazy.clone=function(a){return Lazy(a).value()},Lazy.deprecate=function(a,b){return function(){return console.warn(a),b.apply(this,arguments)}};var arrayPop=Array.prototype.pop,arraySlice=Array.prototype.slice;return Set.prototype.add=function(a){var b,c=this.table,d=typeof a;switch(d){case"number":case"boolean":case"undefined":return!c[a]&&(c[a]=!0,!0);case"string":switch(a.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":a="@"+a}return!c[a]&&(c[a]=!0,!0);default:return b=this.objects,!arrayContains(b,a)&&(b.push(a),!0)}},Set.prototype.contains=function(a){var b=typeof a;switch(b){case"number":case"boolean":case"undefined":return!!this.table[a];case"string":switch(a.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":a="@"+a}return!!this.table[a];default:return arrayContains(this.objects,a)}},Queue.prototype.add=function(a){var b=this.contents,c=b.length,d=this.start;return this.count===c?(b[d]=a,this.start=(d+1)%c):b[this.count++]=a,this},Queue.prototype.toArray=function(){var a=this.contents,b=this.start,c=this.count,d=a.slice(b,b+c);return d.length<c&&(d=d.concat(a.slice(0,c-d.length))),d},Lazy});